<Page
    x:Class="StoreManagementMobile.Presentation.CartPage"
    x:Name="RootPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">

    <Grid Padding="16" RowDefinitions="2*,1*">

        <!-- TOP: CART LIST (Scroll chỉ trong vùng này) -->
        <ScrollViewer Grid.Row="0" VerticalScrollBarVisibility="Auto">
            <ItemsControl ItemsSource="{Binding Items}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>

                        <Border Background="White" Padding="10" CornerRadius="8" Margin="0,0,0,10">
                            <Grid ColumnSpacing="10">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="80" />
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>

                                <!-- IMAGE -->
                                <Border Width="80" Height="80" CornerRadius="6" Background="#EEE">
                                    <Image Source="{Binding ImagePath}" Stretch="UniformToFill"/>
                                </Border>

                                <!-- NAME + PRICE -->
                                <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                    <TextBlock Text="{Binding ProductName}" FontSize="16" FontWeight="Bold" />
                                    <TextBlock Text="{Binding PriceText}" Foreground="Gray" />
                                </StackPanel>

                                <!-- QUANTITY -->
                                <StackPanel Grid.Column="2" VerticalAlignment="Center">
                                    <StackPanel Orientation="Horizontal" Spacing="6">
                                        <Button Width="30" Content="-"
                                                Command="{Binding DataContext.DecreaseQuantityCommand, ElementName=RootPage}"
                                                CommandParameter="{Binding}" />

                                        <TextBlock Text="{Binding Quantity}" VerticalAlignment="Center" Margin="6,0"/>

                                        <Button Width="30" Content="+"
                                                Command="{Binding DataContext.IncreaseQuantityCommand, ElementName=RootPage}"
                                                CommandParameter="{Binding}" />
                                    </StackPanel>

                                    <Button Content="Xóa" Foreground="Red" Margin="0,6,0,0"
                                            Command="{Binding DataContext.RemoveItemCommand, ElementName=RootPage}"
                                            CommandParameter="{Binding}" />
                                </StackPanel>

                            </Grid>
                        </Border>

                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>

        <!-- BOTTOM: PROMO + SUMMARY (không scroll) -->
        <StackPanel Grid.Row="1" Spacing="12" Margin="0,16,0,0">

            <!-- PROMO -->
            <StackPanel Orientation="Horizontal" Spacing="10">
                <TextBox Width="200" PlaceholderText="Nhập mã khuyến mãi"
                         Text="{Binding PromoCode, Mode=TwoWay}"/>
                <Button Content="Áp dụng" Command="{Binding ApplyPromoCommand}"/>
            </StackPanel>

            <!-- SUMMARY -->
            <StackPanel>
                <TextBlock Text="Tạm tính:" />
                <TextBlock Text="{Binding SubtotalText}" FontSize="18" FontWeight="Bold" />

                <TextBlock Text="Giảm giá:" Margin="0,6,0,0"/>
                <TextBlock Text="{Binding DiscountText}" FontSize="16" Foreground="Green"/>

                <TextBlock Text="Tổng cộng:" Margin="0,10,0,0"/>
                <TextBlock Text="{Binding TotalText}" FontSize="22" FontWeight="Bold"/>
            </StackPanel>
        </StackPanel>
    </Grid>
</Page>
