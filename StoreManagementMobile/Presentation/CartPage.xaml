<Page
    x:Class="StoreManagementMobile.Presentation.CartPage"
    x:Name="RootPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:conv="using:StoreManagementMobile.Converters">

    <Page.Resources>
            <conv:BoolToColorConverter x:Key="BoolToColorConverter" />

            <Style TargetType="ComboBox">
                <Setter Property="ScrollViewer.VerticalScrollBarVisibility" Value="Auto"/>
                <Setter Property="MaxDropDownHeight" Value="300"/>
            </Style>
    </Page.Resources>

    <Grid Padding="16" RowDefinitions="2*, 1*">

        <!-- ====================== -->
        <!--  2/3: CART LIST        -->
        <!-- ====================== -->

        <ScrollViewer Grid.Row="0">
            <StackPanel Spacing="12" Margin="0,30,0,0">

                <ItemsControl ItemsSource="{Binding Items}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>

                            <Border Background="White" Padding="12" CornerRadius="10" Margin="0,0,0,10">
                                <Grid ColumnSpacing="12">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="80" />
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>

                                    <!-- IMAGE -->
                                    <Border Width="80" Height="80" CornerRadius="6" Background="#EEE">
                                        <Image Source="{Binding ImagePath}" Stretch="UniformToFill"/>
                                    </Border>

                                    <!-- NAME + PRICE -->
                                    <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                        <TextBlock Text="{Binding ProductName}" FontSize="18" FontWeight="Bold" />
                                        <TextBlock Text="{Binding PriceText}" Foreground="Gray" FontSize="14"/>
                                    </StackPanel>

                                    <!-- QUANTITY + DELETE -->
                                    <StackPanel Grid.Column="2" VerticalAlignment="Center" Spacing="6">

                                        <!-- QUANTITY BUTTONS -->
                                        <StackPanel Orientation="Horizontal" Spacing="10">

                                            <!-- MINUS -->
                                            <Button Width="36" Height="36"
                                                    Background="#008F5A"
                                                    BorderBrush="#008F5A" BorderThickness="2"
                                                    CornerRadius="18"
                                                    Content="−"
                                                    FontSize="20" FontWeight="Bold"
                                                    Foreground="Black"
                                                    Command="{Binding DataContext.DecreaseQuantityCommand, ElementName=RootPage}"
                                                    CommandParameter="{Binding}" />

                                            <TextBox Text="{Binding Quantity, Mode=TwoWay}"
                                                     Width="60"
                                                     HorizontalAlignment="Center"
                                                     VerticalAlignment="Center"
                                                     FontSize="20"
                                                     InputScope="Number"
                                                     LostFocus="QuantityTextBox_LostFocus" />


                                            <!-- PLUS -->
                                            <Button Width="36" Height="36"
                                                    Background="#008F5A"
                                                    BorderBrush="#008F5A" BorderThickness="2"
                                                    CornerRadius="18"
                                                    Content="+"
                                                    FontSize="20" FontWeight="Bold"
                                                    Foreground="Black"
                                                    Command="{Binding DataContext.IncreaseQuantityCommand, ElementName=RootPage}"
                                                    CommandParameter="{Binding}" />

                                        </StackPanel>

                                        <!-- DELETE -->
                                        <Button Content="Xóa"
                                                Foreground="White"
                                                Background="#008F5A"
                                                Command="{Binding DataContext.RemoveItemCommand, ElementName=RootPage}"
                                                CommandParameter="{Binding}" />

                                    </StackPanel>

                                </Grid>
                            </Border>

                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>

            </StackPanel>
        </ScrollViewer>


        <!-- ====================== -->
        <!--  1/3: FOOTER           -->
        <!-- ====================== -->

        <StackPanel Grid.Row="1" Spacing="12" Margin="0,10,0,0">

            <TextBlock Text="Mã khuyến mãi:" FontWeight="SemiBold"/>

            <ComboBox ItemsSource="{Binding PromoList}"
                      SelectedItem="{Binding SelectedPromo, Mode=TwoWay}"
                      MaxDropDownHeight="250">
                <ComboBox.ItemTemplate>
                    <DataTemplate>
                        <TextBlock Text="{Binding DisplayText}"
                                   Foreground="{Binding IsEnabled, Converter={StaticResource BoolToColorConverter}}" />
                    </DataTemplate>
                </ComboBox.ItemTemplate>
            </ComboBox>


            <!-- APPLY BUTTON -->
            <Button Content="Áp dụng"
                    Background="#008F5A"
                    Foreground="White"
                    CornerRadius="6"
                    Command="{Binding ApplyPromoCommand}" />

            <!-- SUMMARY -->
            <StackPanel>
                <TextBlock Text="Tạm tính:" />
                <TextBlock Text="{Binding SubtotalText}" FontSize="18" FontWeight="Bold" />

                <TextBlock Text="Giảm giá:" Margin="0,6,0,0"/>
                <TextBlock Text="{Binding DiscountText}" FontSize="16" Foreground="#008F5A"/>

                <TextBlock Text="Tổng cộng:" Margin="0,10,0,0"/>
                <TextBlock Text="{Binding TotalText}" FontSize="24" FontWeight="Bold"/>

                <Button Content="Tiếp tục thanh toán"
                        Background="#008F5A"
                        Foreground="White"
                        CornerRadius="6"
                        Command="{Binding ContinuePaymentCommand}" />
            </StackPanel>

        </StackPanel>

    </Grid>
</Page>
